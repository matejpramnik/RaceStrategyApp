@model Race
@{
	ViewData["Title"] = "Race";
}


<form asp-action="NewRace" method="post">
    <div>
        <label asp-for="Id"></label>
        <input asp-for="Id" />
    </div>
    <div>
        <label asp-for="Name"></label>
        <input asp-for="Name" />
    </div>
    <div>
        <label asp-for="NumberOfLaps"></label>
        <input asp-for="NumberOfLaps" />
    </div>
    <div>
        <label asp-for="MandatoryStops"></label>
        <input asp-for="MandatoryStops" />
    </div>
    <div>
        <label asp-for="Refueling"></label>
        <input asp-for="Refueling" />
    </div>
    <div>
        <label asp-for="Position"></label>
        <input asp-for="Position" />
    </div>
    <div>
        <label asp-for="AmountOfOpponents"></label>
        <input asp-for="AmountOfOpponents" />
    </div>
    <div>
        <label asp-for="TrackWeather"></label>
        <input asp-for="TrackWeather" />
    </div>


    <h4>Tyre Selection</h4>
    <div id="tyresContainer">
        @for (int i = 0; i < Model.SelectedTyres.Count; i++) {
            <div class="form-group row mb-3" data-index="@i">
                <div class="col-10">
                    <label class="form-label">Tyre #@(i + 1)</label>
                    <select asp-for="SelectedTyres[i]"
                            class="form-select tyre-dropdown">
                        <option value="">-- Select Compound --</option>
                        @foreach (var compound in Enum.GetValues(typeof(tyreCompound))) {
                            <option value="@compound"
                                    selected="@(Model.SelectedTyres[i] == (tyreCompound)compound)">
                                @compound
                            </option>
                        }
                    </select>
                </div>
                <div class="col-2 align-self-end">
                    @if (i > 0) {
                        <button type="button"
                                class="btn btn-danger remove-tyre"
                                data-index="@i">
                            Remove
                        </button>
                    }
                </div>
            </div>
        }
    </div>

    <div class="mb-3">
        <button type="button" id="addTyre" class="btn btn-secondary">
            Add Another Tyre
        </button>
    </div>

    <div>
        <label asp-for="RaceSeriesId"></label>
        <input asp-for="RaceSeriesId" />
    </div>


    <input type="hidden" asp-for="Damage" />
    <input type="hidden" asp-for="TerminalDamage" />
    <input type="hidden" asp-for="TrackState" />
    <input type="hidden" asp-for="LapCount" />

    <button type="submit" class="btn btn-primary">Uložiť</button>
    
</form>

@section Scripts {
    <script>
        $(function() {
            // Add new tyre dropdown
            $('#addTyre').click(function() {
                const index = $('.tyre-dropdown').length;
                const dropdownHtml = `
                    <div class="form-group row mb-3" data-index="${index}">
                        <div class="col-10">
                            <label class="form-label">Tyre #${index + 1}</label>
                            <select name="SelectedTyres[${index}]"
                                    class="form-select tyre-dropdown">
                                <option value="">-- Select Compound --</option>
        @foreach (var compound in Enum.GetValues(typeof(tyreCompound))) {
                                            <option value="@compound">@compound</option>
        }
                            </select>
                        </div>
                        <div class="col-2 align-self-end">
                            <button type="button"
                                    class="btn btn-danger remove-tyre"
                                    data-index="${index}">Remove</button>
                        </div>
                    </div>`;

                $('#tyresContainer').append(dropdownHtml);
            });

            // Remove tyre dropdown
            $(document).on('click', '.remove-tyre', function() {
                const index = $(this).data('index');
                $(`[data-index="${index}"]`).remove();
            });
        });
    </script>
}

